[
  {
    "align_labels_right": 0,
    "custom_format": 1,
    "default_print_language": "en",
    "disabled": 0,
    "doc_type": "Sales Invoice",
    "docstatus": 0,
    "doctype": "Print Format",
    "font": "Default",
    "font_size": 0,
    "format_data": null,
    "html": "<style>\n@page { size: A4; margin: 1mm 10mm 10mm 10mm; }\n.invoice-container { width: 100%; max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif; padding: 10px; }\n.header { border-bottom: 1px solid #000; padding-bottom: 8px; margin-bottom: 10px; text-align: center; }\n.company-name { text-align: center; font-weight: bold; font-size: 16px; margin-bottom: 3px; }\n.address { text-align: center; margin: 3px 0; font-size: 11px; }\n.party-details { margin: 10px 0; font-size: 12px; }\n.items-table { width: 100%; margin: 0; font-size: 12px; table-layout: fixed; border-collapse: collapse; line-height: 1; }\n.items-table th { border: 1px solid #000; font-size: 13px; font-weight: bold !important; padding: 2px 3px !important; background-color: #fff; vertical-align: middle; }\n.items-table td { border: 1px solid #000; padding: 0.1px 3px !important; vertical-align: top; }\n.items-table thead tr { border-bottom: 2px solid #000 !important; margin-bottom: 8px !important; }\n.group-header td, .group-header { border-top: 2px solid #000 !important; border-bottom: 2px solid #000 !important; background-color: #f0f0f0; padding: 4px 3px !important; }\n.group-total td, .group-total { border-bottom: 2px solid #000 !important; background-color: #e0e0e0; padding: 8px 3px !important; }\n.text-right { text-align: right; }\n.description-cell {  white-space: normal;  overflow-wrap: anywhere;  word-break: break-word; }\n.footer { margin-top: 15px; border-top: 1px solid #000; padding-top: 10px; font-size: 13px; }\n.footer-columns { display: flex; justify-content: space-between; margin-top: 10px; }\n.terms-conditions { width: 55%; text-align: left; }\n.amount-signature { width: 40%; text-align: right; }\n.footer .small, .footer-info { display: none !important; }\n.total-section { display: flex; justify-content: space-between; margin-top: 10px; }\n.total-qty { font-weight: bold; }\n.amount-words {\n    width: 100%;\n    text-align: left;\n    font-size: 12px;\n    margin-top: 6px;\n    font-weight: bold;\n    word-break: break-word;\n}\n.signature-spacing { margin-top: 5px !important; }\n.school-ref-container { display: flex; justify-content: center; gap: 20px; margin-top: 5px; }\n.ref-items { display: flex; gap: 15px; }\n.qr-upi {\n  text-align: center;\n  margin-top: 12px;\n}\n.qr-upi img {\n  margin-top: 6px;\n  width: 100px;\n  height: 100px;\n}\n.qr-upi .upi-note {\n  font-size: 12px;\n  margin-top: 4px;\n}\n</style>\n\n<div class=\"invoice-container\">\n    <!-- Header Section -->\n    <div class=\"header\">\n      <h1>Splashbox</h1>\n      <p>Behind Axis Bank, J.H. Collage, Road, Betul (M.P.)</p>\n      <p>GSTIN: 23BXIPK0049R1Z5 | Mob. No.: 8989274242</p>\n      <p>Tax Invoice</p>\n    </div>\n\n    <!-- Party Details -->\n    <div class=\"party-details\">\n        <div style=\"display: flex; justify-content: space-between;\">\n            <div>\n                <strong>Party:</strong> {{ doc.custom_reference_name }}<br>\n                <strong>Mob:</strong> {{ doc.custom_reference_no }}<br>\n                <div class=\"school-ref-container\">\n                    <div><strong>School:</strong> {{ doc.customer_name }}</div>\n                </div>\n            </div>\n            <div>\n                <strong>Bill No:</strong> {{ doc.name }}<br>\n                <strong>Date:</strong> {{ frappe.format_date(doc.posting_date) }}\n            </div>\n        </div>\n    </div>\n\n    <!-- Items Table with Sorted Groups -->\n    <table class=\"items-table\">\n        <thead>\n            <tr>\n                <th width=\"5%\">SN.</th>\n                <th width=\"35%\">Description</th>\n                <th width=\"12%\">Company</th>\n                <th width=\"7%\">Qty.</th>\n                <th width=\"7%\">Unit</th>\n                <th width=\"11%\">MRP</th>\n                <th width=\"7%\">Dis</th>\n                <th width=\"6%\">Disc Amt</th>\n                <th width=\"10%\">Amount</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% set groups = {} %}\n            {% set sn = [1] %}\n            {% set total_qty = [0.0] %}\n            \n            <!-- Build a list of all \"Not Available\" item codes -->\n            {% set all_na_codes = [] %}\n            {% for bundle_id in doc.items | map(attribute='custom_bundle_id') | unique %}\n                {% if bundle_id %}\n                    {% set bundle_doc = frappe.get_doc('Product Bundle', bundle_id) %}\n                    {% set na_items = bundle_doc.items | selectattr('custom_product_bundle_stock', 'equalto', 'Not Available') | map(attribute='item_code') | list %}\n                    {% for na_code in na_items %}\n                        {% set _ = all_na_codes.append(na_code) %}\n                    {% endfor %}\n                {% endif %}\n            {% endfor %}\n            \n            {% for item in doc.items %}\n                <!-- Skip items that are marked as \"Not Available\" in their bundle -->\n                {% set skip_item = false %}\n                {% if item.custom_bundle_id and item.item_code in all_na_codes %}\n                    {% set skip_item = true %}\n                {% endif %}\n                \n                {% if not skip_item %}\n                    {% set group = item.item_group or \"Ungrouped\" %}\n                    {% set amount = item.qty * item.rate %}\n                    {% if not groups.get(group) %}\n                        {% set _ = groups.update({group: {\"total_qty\": 0.0, \"total_amount\": 0.0, \"entries\": []}}) %}\n                    {% endif %}\n                    {% set _ = groups[group].update({\n                        \"total_qty\": groups[group].total_qty + item.qty,\n                        \"total_amount\": groups[group].total_amount + amount\n                    }) %}\n                    {% set _ = groups[group].entries.append({\"item\": item, \"amount\": amount}) %}\n                    {% set _ = total_qty.append(total_qty.pop() + item.qty) %}\n                {% endif %}\n            {% endfor %}\n\n            {% for group_name in groups.keys()|sort %}\n                {% set g = groups[group_name] %}\n                <tr class=\"group-header\">\n                    <td colspan=\"9\">{{ group_name }} ({{ g.entries|length }} items)</td>\n                </tr>\n                {% for entry in g.entries %}\n                    <tr>\n                        <td>{{ sn[0] }}</td>\n                        <td class=\"description-cell\" title=\"{{ entry.item.item_name }}\">{{ entry.item.item_name }}</td>\n                        <td>{{ entry.item.brand }}</td>\n                        <td>{{ entry.item.qty }}</td>\n                        <td>{{ entry.item.uom }}</td>\n                        <td class=\"text-right\">\n                          {{ frappe.format_value(entry.item.price_list_rate, currency=doc.currency) if frappe.format_value(entry.item.price_list_rate, currency=doc.currency) is string else \"%.2f\"|format(entry.item.price_list_rate) }}\n                        </td>\n                        <td class=\"text-right\">{{ entry.item.discount_percentage }}%</td>\n                        <td class=\"text-right\">\n                            {% set discount_amt = (entry.item.price_list_rate * entry.item.qty) - (entry.item.rate * entry.item.qty) %}\n                            {% if discount_amt > 0 %}\n                                -{{ \"%.2f\"|format(discount_amt) }}\n                            {% else %}\n                                {{ \"%.2f\"|format(0) }}\n                            {% endif %}\n                        </td>\n                        <td class=\"text-right\">{{ \"%.2f\"|format(entry.amount) }}</td>\n                    </tr>\n                    {% set _ = sn.append(sn.pop() + 1) %}\n                {% endfor %}\n                <tr class=\"group-total\">\n                    <td colspan=\"3\">Group Total</td>\n                    <td>{{ \"%.2f\"|format(g.total_qty) }}</td>\n                    <td colspan=\"4\"></td>\n                    <td class=\"text-right\">{{ \"%.2f\"|format(g.total_amount) }}</td>\n                </tr>\n            {% endfor %}\n        </tbody>\n    </table>\n\n    <!-- Totals Section -->\n    <div class=\"total-section\">\n        <div class=\"total-qty\">Total Quantity: {{ \"%.2f\"|format(total_qty[0]) }}</div>\n        <div class=\"total-figures\">\n            {% if doc.rounding_adjustment %}\n            <div><strong>Round Off:</strong> {{ \"%.2f\"|format(doc.rounding_adjustment) }}</div>\n            {% endif %}\n            <div><strong>Total:</strong> {{ \"%.2f\"|format(doc.rounded_total) }}</div>\n        </div>\n    </div>\n    <div class=\"amount-words\">\n        <strong>Amount in Words:</strong> {{ doc.in_words }}\n    </div>\n\n    <!-- Items - Not Available Section -->\n    {% for bundle in doc.items | map(attribute='custom_bundle_id') | unique %}\n        {% if bundle %}\n            {% set bundle_doc = frappe.get_doc('Product Bundle', bundle) %}\n            {% set na_items = bundle_doc.items | selectattr('custom_product_bundle_stock', 'equalto', 'Not Available') | list %}\n            {% set na_codes = na_items | map(attribute='item_code') | list %}\n            {% if na_items %}\n                <h4>Items - Not Available: {{ bundle_doc.description }}</h4>\n                <table class=\"items-table\">\n                    <thead>\n                        <tr>\n                            <th width=\"5%\">SN.</th>\n                            <th width=\"35%\">Description</th>\n                            <th width=\"12%\">Company</th>\n                            <th width=\"7%\">Qty.</th>\n                            <th width=\"7%\">Unit</th>\n                            <th width=\"11%\">MRP</th>\n                            <th width=\"7%\">Dis</th>\n                            <th width=\"6%\">Disc Amt</th>\n                            <th width=\"10%\">Amount</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {% set nasn = [1] %}\n                        {% for na_item in na_items %}\n                            {% set itm = frappe.get_doc(\"Item\", na_item.item_code) %}\n                            <tr>\n                                <td>{{ nasn[0] }}</td>\n                                <td class=\"description-cell\" title=\"{{ itm.item_name }}\">{{ itm.item_name }}</td>\n                                <td>{{ itm.brand or '' }}</td>\n                                <td>{{ na_item.qty }}</td>\n                                <td>{{ na_item.uom }}</td>\n                                <td class=\"text-right\">{{ \"%.2f\"|format(na_item.rate or 0) }}</td>\n                                <td class=\"text-right\">0.0%</td>\n                                <td class=\"text-right\">0.00</td>\n                                <td class=\"text-right\">0.00</td>\n                            </tr>\n                            {% set _ = nasn.append(nasn.pop() + 1) %}\n                        {% endfor %}\n                        <tr class=\"group-total\">\n                            <td colspan=\"8\" class=\"text-right\">Group Total</td>\n                            <td class=\"text-right\">0.00</td>\n                        </tr>\n                    </tbody>\n                </table>\n            {% endif %}\n        {% endif %}\n    {% endfor %}\n\n    <!-- Missing or Reduced Items in Bundle Section -->\n    {% for bundle in doc.items | map(attribute='custom_bundle_id') | unique %}\n        {% if bundle %}\n            {% set bundle_doc = frappe.get_doc('Product Bundle', bundle) %}\n            \n            <!-- Create a list to track removed items -->\n            {% set removed_items_list = [] %}\n            \n            <!-- First, check for items marked as \"Not Available\" that should be excluded -->\n            {% set na_items = bundle_doc.items | selectattr('custom_product_bundle_stock', 'equalto', 'Not Available') | map(attribute='item_code') | list %}\n            \n            <!-- Build dictionary of bundle items (excluding NA items) -->\n            {% set bundle_items_dict = {} %}\n            {% for b_item in bundle_doc.items %}\n                {% if b_item.item_code not in na_items %}\n                    {% set _ = bundle_items_dict.update({b_item.item_code: {'qty': b_item.qty, 'item': b_item}}) %}\n                {% endif %}\n            {% endfor %}\n            \n            <!-- Build dictionary of billed items -->\n            {% set billed_items_dict = {} %}\n            {% for item in doc.items %}\n                {% if item.custom_bundle_id == bundle and item.item_code not in na_items %}\n                    {% set current_qty = billed_items_dict.get(item.item_code, 0) %}\n                    {% set _ = billed_items_dict.update({item.item_code: current_qty + item.qty}) %}\n                {% endif %}\n            {% endfor %}\n            \n            <!-- Check for missing or reduced quantity items -->\n            {% for item_code, bundle_data in bundle_items_dict.items() %}\n                {% set billed_qty = billed_items_dict.get(item_code, 0) %}\n                {% set bundle_qty = bundle_data.qty %}\n                {% if billed_qty < bundle_qty %}\n                    {% set _ = removed_items_list.append({\n                        'item': bundle_data.item,\n                        'removed_qty': bundle_qty - billed_qty,\n                        'item_code': item_code\n                    }) %}\n                {% endif %}\n            {% endfor %}\n            \n            {% if removed_items_list|length > 0 %}\n                <h4>Remove Item(s) from Bundle: {{ bundle_doc.description }}</h4>\n                <table class=\"items-table\">\n                    <thead>\n                        <tr>\n                            <th width=\"5%\">SN.</th>\n                            <th width=\"35%\">Description</th>\n                            <th width=\"12%\">Company</th>\n                            <th width=\"7%\">Qty.</th>\n                            <th width=\"7%\">Unit</th>\n                            <th width=\"11%\">MRP</th>\n                            <th width=\"7%\">Dis</th>\n                            <th width=\"6%\">Disc Amt</th>\n                            <th width=\"10%\">Amount</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {% set misn = [1] %}\n                        {% for removed_item in removed_items_list %}\n                            {% set b_item = removed_item.item %}\n                            {% if b_item %}\n                                {% set itm = frappe.get_doc(\"Item\", b_item.item_code) %}\n                                {% set rate = frappe.db.get_value(\"Item Price\", {\"item_code\": b_item.item_code, \"selling\": 1}, \"price_list_rate\") or 0.0 %}\n                                <tr>\n                                    <td>{{ misn[0] }}</td>\n                                    <td class=\"description-cell\" title=\"{{ itm.item_name }}\">{{ itm.item_name }}</td>\n                                    <td>{{ itm.brand or '' }}</td>\n                                    <td>{{ removed_item.removed_qty }}</td>\n                                    <td>{{ itm.stock_uom or '' }}</td>\n                                    <td class=\"text-right\">{{ \"%.2f\"|format(rate) }}</td>\n                                    <td class=\"text-right\">0.0%</td>\n                                    <td class=\"text-right\">0.00</td>\n                                    <td class=\"text-right\">0.00</td>\n                                </tr>\n                                {% set _ = misn.append(misn.pop() + 1) %}\n                            {% endif %}\n                        {% endfor %}\n                        <tr class=\"group-total\">\n                            <td colspan=\"8\" class=\"text-right\">Group Total</td>\n                            <td class=\"text-right\">0.00</td>\n                        </tr>\n                    </tbody>\n                </table>\n            {% endif %}\n        {% endif %}\n    {% endfor %}\n\n    <!-- Footer Section -->\n    <div class=\"footer\">\n        <div class=\"footer-columns\">\n            <div class=\"terms-conditions\">\n                <strong>Terms & Conditions:</strong><br>\n                1. Subject to Betul Jurisdiction only.<br>\n                2. If any difference in MRP of NCERT book<br>\n                kindly bring book & bill for refund.\n            </div>\n              <!-- QR Code for UPI Payment -->\n            <div class=\"qr-upi\">\n           {% set upi_id = \"eazypay.0000056694@icici\" %}\n           {% set upi_url = \"upi://pay?pa=\" ~ upi_id ~ \"&pn=ICICI&am=\" ~ (doc.rounded_total|string) ~ \"&cu=INR&tn=\" ~ doc.name %}\n            <strong>Scan & Pay via UPI</strong><br>\n           <img src=\"https://api.qrserver.com/v1/create-qr-code/?size=140x140&data={{ upi_url | urlencode }}\" alt=\"UPI QR Code\">\n           <div class=\"upi-note\">Pay \u20b9{{ \"%.2f\"|format(doc.rounded_total) }} to {{ upi_id }}</div>\n             </div>\n            <div class=\"amount-signature\">\n                <p>For {{ doc.company }}</p>\n                <p class=\"signature-spacing\">Authorized Signatory</p>\n            </div>\n        </div>\n    </div>\n</div>",
    "line_breaks": 0,
    "margin_bottom": 10.0,
    "margin_left": 10.0,
    "margin_right": 10.0,
    "margin_top": 1.0,
    "modified": "2025-01-10 15:00:00.000000",
    "module": "POSAwesome",
    "name": "Splashbox Bundle Invoice",
    "page_number": "Hide",
    "print_format_builder": 0,
    "print_format_builder_beta": 0,
    "print_format_type": "Jinja",
    "raw_commands": null,
    "raw_printing": 0,
    "show_section_headings": 0,
    "standard": "No"
  }
]
